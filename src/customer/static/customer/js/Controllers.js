// Generated by CoffeeScript 1.9.2
(function() {
  var get_url_by_name, print;

  angular.module("Customer").controller("CustomerBase", function($scope, $location, CUSTOMER_ANONYMOUS_URLS, CUSTOMER_URLS) {
    return angular.extend($scope, {
      get_urls: function() {
        if (this.customer.email) {
          return CUSTOMER_URLS;
        } else {
          return CUSTOMER_ANONYMOUS_URLS;
        }
      },
      get_sidebar: function() {
        return window.ng_config.static_url + "js/app/site/view/customer_menu.html";
      },
      is_active_menu: function(path) {
        if ($location.path() === path) {
          return 'active';
        }
      }
    });
  }).controller("Signup", function($scope, $location, CustomerModel, CUSTOMER_URLS) {
    return angular.extend($scope, {
      info: {},
      check_form: function() {
        return this.signup_form.$valid && this.info.password === this.repeat_password;
      },
      save: function() {
        var customer;
        if (!this.check_form()) {
          return;
        }
        customer = new CustomerModel(this.info);
        return customer.$save().then(function(data) {
          angular.extend($scope.customer, data);
          return $location.path(get_url_by_name(CUSTOMER_URLS, 'orders').url);
        });
      }
    });
  }).controller("Logout", function($scope, $location, LoginResource, CUSTOMER_ANONYMOUS_URLS) {
    return $scope.logout = function() {
      return (new LoginResource()).$delete().then(function() {
        $scope.customer.email = null;
        return $location.path(get_url_by_name(CUSTOMER_ANONYMOUS_URLS, 'signin').url);
      });
    };
  }).controller("Signin", function($scope, $location, LoginResource, CUSTOMER_URLS) {
    return $scope.signin = function() {
      return (new LoginResource(this.info)).$save().then(function(data) {
        angular.extend($scope.customer, data);
        return $location.path(get_url_by_name(CUSTOMER_URLS, 'orders').url);
      });
    };
  });

  get_url_by_name = function(collection, name) {
    return _.find(collection, function(url) {
      return url.name === name;
    });
  };

  print = console.log.bind(console);

}).call(this);
