// Generated by CoffeeScript 1.10.0
(function() {
  angular.module('ParsersApp', ['xml', 'ngResource']).config(function(x2jsProvider, $httpProvider) {
    x2jsProvider.config = {
      escapeMode: true
    };
    return $httpProvider.interceptors.push('xmlHttpInterceptor');
  }).factory('getYamCatalogTree', function(CatalogModel) {
    return function(catalog_list) {
      var get_model, root, set_children;
      get_model = function(xml_model) {
        return new CatalogModel({
          id: xml_model._id,
          title: xml_model.__text,
          parent_id: xml_model._parentId
        });
      };
      set_children = function(catalogs, parent) {
        var filtered;
        if (_.isEmpty(catalogs)) {
          return;
        }
        parent.children = [];
        filtered = _.filter(catalogs, function(item) {
          if (item._parentId === parent.id) {
            return parent.children.push(get_model(item)) && false;
          } else {
            return true;
          }
        });
        if (_.isEmpty(parent.children)) {
          return;
        }
        return _.map(parent.children, function(item) {
          return set_children(filtered, item);
        });
      };
      set_children(catalog_list, root = {});
      return root;
    };
  }).factory('getYamProducts', function(ProductModel) {
    return function(product_list) {
      var make_product;
      make_product = function(product) {
        return new ProductModel({
          id: product._id,
          title: product.name,
          available: product._available === "true",
          parent_id: product.categoryId,
          currency_id: product.currentcyId,
          descritpion: product.descritpion,
          file: product.picture,
          price: product.price,
          url: product.url,
          params: _.map(product.param, function(param) {
            return {
              value: param.__text,
              name: param._name
            };
          })
        });
      };
      return _.map(product_list, make_product);
    };
  }).factory('CatalogModel', function($resource) {
    return $resource("/url/:id");
  }).factory('ProductModel', function($resource) {
    return $resource("/product/:id");
  }).directive('catalogTree', function() {
    return {
      templateUrl: '/static/parsers/js/views/local_catalog.html'
    };
  }).factory('catalogTreeControllerMixin', function() {
    return function($scope) {
      return _.extend($scope, {
        catalog_selected: function(catalog) {
          $scope.current_catalog = catalog;
          return typeof $scope.catalog_selected_after === "function" ? $scope.catalog_selected_after(catalog) : void 0;
        },
        is_active_catalog: function(catalog) {
          if (catalog === $scope.current_catalog) {
            return "uk-active";
          } else {
            return "";
          }
        }
      });
    };
  });

}).call(this);
