// Generated by CoffeeScript 1.9.2
(function() {
  var alert, alert_text, check_redirect;

  angular.module('Site', ['Catalog', 'Customer', 'FeedbackApp']).factory('httpInterceptor', function($q) {
    return {
      request: function(config) {
        return config || $q.when(config);
      },
      response: function(response) {
        if (response.data._success) {
          alert(response.data._success, 'success');
          delete response.data._success;
          check_redirect(response.data);
        }
        return response || $q.when(response);
      },
      responseError: function(response) {
        var error;
        alert(error = response.data._error ? response.data._error : response.status);
        return $q.reject(response);
      }
    };
  }).config(function($httpProvider) {
    return $httpProvider.interceptors.push('httpInterceptor');
  });

  alert = function(text, type) {
    if (type == null) {
      type = 'danger';
    }
    return UIkit.modal.alert(alert_text({
      text: text,
      type: type
    }), {
      center: true
    });
  };

  check_redirect = function(obj) {
    if (obj._redirect) {
      return $(document).one('hide.uk.modal', function() {
        return window.location.href = obj._redirect;
      });
    }
  };

  alert_text = _.template('<p class="uk-text-<%- type %>">\n  <%- text %>\n</p>');

}).call(this);
